<div class="modal fade" id="categoryModal" tabindex="-1" aria-labelledby="categoryModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg" style="border-radius: 16px;">
      <div class="modal-header border-bottom-0 pt-4 px-4">
        <h5 class="modal-title font-weight-bold" id="categoryModalLabel" style="color: #1E293B;">Add New Category</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <% @category ||= Category.new %>
      
      <%= form_with(model: @category, local: true, html: { novalidate: true }) do |f| %>
        <div class="modal-body px-4">
          
          <div class="form-group mb-3">
            <%= f.label :name, "Category Name", class: "form-label text-sm font-weight-bold", style: "color: #64748B;" %>
            <%= f.text_field :name, class: "form-control #{'is-invalid' if @category.errors[:name].any?}", 
                placeholder: "e.g. Electronics", style: "border-radius: 10px; padding: 10px 15px;" %>
            <% if @category.errors[:name].any? %>
              <div class="invalid-feedback"><%= @category.errors[:name].first %></div>
            <% end %>
          </div>

          <div class="form-group mb-3">
            <%= f.label :sku, "SKU Code", class: "form-label text-sm font-weight-bold", style: "color: #64748B;" %>
            <%= f.text_field :sku, class: "form-control #{'is-invalid' if @category.errors[:sku].any?}", 
                placeholder: "CAT-XXXX", style: "border-radius: 10px; padding: 10px 15px;" %>
            <% if @category.errors[:sku].any? %>
              <div class="invalid-feedback"><%= @category.errors[:sku].first %></div>
            <% end %>
          </div>

          <div class="form-group mb-3">
            <%= f.label :description, "Description", class: "form-label text-sm font-weight-bold", style: "color: #64748B;" %>
            <%= f.text_area :description, rows: 3, class: "form-control #{'is-invalid' if @category.errors[:description].any?}", 
                placeholder: "Short description about this category...", style: "border-radius: 10px; padding: 10px 15px;" %>
            <% if @category.errors[:description].any? %>
              <div class="invalid-feedback"><%= @category.errors[:description].first %></div>
            <% end %>
          </div>

        </div>

        <div class="modal-footer border-top-0 pb-4 px-4">
          <button type="button" class="btn btn-light font-weight-bold" data-bs-dismiss="modal" style="border-radius: 10px; padding: 10px 20px; color: #64748B;">Cancel</button>
          <%= f.submit "Create Category", class: "btn btn-primary font-weight-bold", 
              style: "background-color: #6366F1; border: none; border-radius: 10px; padding: 10px 25px;",
              data: { disable_with: "Saving..." } %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  function toggleCategoryModal() {
    const hasErrors = <%= @category.errors.any? %>;
    const modalElement = document.getElementById('categoryModal');
    
    if (hasErrors && modalElement) {
      const categoryModal = new bootstrap.Modal(modalElement);
      categoryModal.show();
    }
  }

  document.addEventListener('DOMContentLoaded', toggleCategoryModal);
  
  document.addEventListener('turbo:load', toggleCategoryModal);
  document.addEventListener('turbo:render', toggleCategoryModal);
</script>