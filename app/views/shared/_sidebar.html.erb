<%# Navbar %>
<nav class="main-header navbar navbar-expand navbar-white navbar-light border-bottom-0">
  <ul class="navbar-nav">
    <li class="nav-item">
      <%# Added data-enable-remember="true" to keep state across searches %>
      <a class="nav-link" data-widget="pushmenu" href="#" role="button" data-enable-remember="true">
        <i class="fas fa-bars"></i>
      </a>
    </li>
  </ul>

  <ul class="navbar-nav ml-auto align-items-center">
    <% if user_signed_in? %>
      <li class="nav-item d-none d-md-block mr-3">
        <span class="text-muted small">Welcome, <strong><%= current_user.name %></strong></span>
      </li>
      <li class="nav-item">
        <%= button_to destroy_user_session_path, method: :delete, class: 'btn btn-light btn-sm text-danger rounded-circle', title: 'Sign Out' do %>
          <i class="fas fa-sign-out-alt"></i>
        <% end %>
      </li>
      <% else %>
      <li class="nav-item">
        <button class="nav-link btn btn-link" data-bs-toggle="modal" data-bs-target="#loginModal" style="padding: 0; border: none; background: none; cursor: pointer;">
          <i class="fas fa-sign-in-alt"></i> Sign In
        </button>
      </li>
    <% end %>
  </ul>
</nav>

<aside class="main-sidebar elevation-0">
  <%# Header with a "Close" button for Mobile only %>
  <div class="brand-link d-flex align-items-center justify-content-between">
    <a href="<%= root_path %>" class="text-decoration-none">
      <span class="brand-text font-weight-bold ml-2">MY WAREHOUSE</span>
    </a>
    <%# This button only shows on small screens to let users manually hide sidebar %>
    <a href="#" class="d-lg-none text-muted mr-2" data-widget="pushmenu">
      <i class="fas fa-times"></i>
    </a>
  </div>

  <div class="sidebar">
    <nav class="mt-3">
      <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
        
        <% if user_signed_in? && (can?(:see_menu, Product) || can?(:read, Product)) %>
          <li class="nav-item has-treeview <%= 'menu-open' if ['products', 'categories', 'unit_of_measurements'].include?(controller_name) %>">
            <a href="#" class="nav-link <%= 'active' if ['products', 'categories', 'unit_of_measurements'].include?(controller_name) %>">
              <i class="nav-icon fas fa-box"></i>
              <p>Inventory <i class="right fas fa-angle-left"></i></p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="<%= products_path %>" class="nav-link <%= 'active' if controller_name == 'products' %>">
                  <i class="far <%= controller_name == 'products' ? 'fa-dot-circle' : 'fa-circle' %> nav-icon"></i>
                  <p>All Products</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="<%= categories_path %>" class="nav-link <%= 'active' if controller_name == 'categories' %>">
                  <i class="far <%= controller_name == 'categories' ? 'fa-dot-circle' : 'fa-circle' %> nav-icon"></i>
                  <p>Categories</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="<%= unit_of_measurements_path %>" class="nav-link <%= 'active' if controller_name == 'unit_of_measurements' %>">
                  <i class="far <%= controller_name == 'unit_of_measurements' ? 'fa-dot-circle' : 'fa-circle' %> nav-icon"></i>
                  <p>Units (UOM)</p>
                </a>
              </li>
            </ul>
          </li>
        <% end %>

        <% if user_signed_in? && (can?(:see_menu, Province) || can?(:read, Province)) %>
          <li class="nav-item has-treeview <%= 'menu-open' if ['provinces', 'cities'].include?(controller_name) %>">
            <a href="#" class="nav-link <%= 'active' if ['provinces', 'cities'].include?(controller_name) %>">
              <i class="nav-icon fas fa-map-marker-alt"></i>
              <p>Regional Zone <i class="right fas fa-angle-left"></i></p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="<%= provinces_path %>" class="nav-link <%= 'active' if controller_name == 'provinces' %>">
                  <i class="far <%= controller_name == 'provinces' ? 'fa-dot-circle' : 'fa-circle' %> nav-icon"></i>
                  <p>Provinces</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="<%= cities_path %>" class="nav-link <%= 'active' if controller_name == 'cities' %>">
                  <i class="far <%= controller_name == 'cities' ? 'fa-dot-circle' : 'fa-circle' %> nav-icon"></i>
                  <p>Cities</p>
                </a>
              </li>
            </ul>
          </li>
        <% end %>

        <% if user_signed_in? && current_user.role&.name == "Admin" %>
          <li class="nav-header mt-3 text-uppercase small" style="color: #94a3b8;">Settings</li>
          <li class="nav-item has-treeview <%= 'menu-open' if ['roles', 'users'].include?(controller_name) %>">
            <a href="#" class="nav-link <%= 'active' if ['roles', 'users'].include?(controller_name) %>">
              <i class="nav-icon fas fa-users-cog"></i>
              <p>Access Control <i class="right fas fa-angle-left"></i></p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <%= link_to roles_path, class: "nav-link #{'active' if controller_name == 'roles'}" do %>
                  <i class="far <%= controller_name == 'roles' ? 'fa-dot-circle' : 'fa-circle' %> nav-icon"></i>
                  <p>Roles</p>
                <% end %>
              </li>
              <li class="nav-item">
                <%= link_to users_path, class: "nav-link #{'active' if controller_name == 'users'}" do %>
                  <i class="far <%= controller_name == 'users' ? 'fa-dot-circle' : 'fa-circle' %> nav-icon"></i>
                  <p>Users</p>
                <% end %>
              </li>
            </ul>
          </li>
        <% end %>
      </ul>
    </nav>
  </div>
</aside>

<%# IMPORTANT: This div handles closing the sidebar when clicking outside on mobile %>
<div id="sidebar-overlay" data-widget="pushmenu"></div>